<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Подработки и зарплата — v6.1</title>
<meta name="theme-color" content="#0b0d12">
<meta name="apple-mobile-web-app-capable" content="yes">
<style>
  *,*::before,*::after{box-sizing:border-box}
  :root{--bg:#0f1115;--card:#151922;--cardSoft:#1a1f2a;--text:#e9eef5;--muted:#9aa5b1;--line:#242a34;--accent:#3b82f6;--danger:#ef4444;--btn:#0f1320;--btnText:#e9eef5}
  :root[data-theme="light"]{--bg:#f5f7fb;--card:#ffffff;--cardSoft:#f1f3f5;--text:#111827;--muted:#6b7280;--line:#e5e7eb;--accent:#2563eb;--danger:#b91c1c;--btn:#ffffff;--btnText:#111827}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px;background:#0b0d12;border-bottom:1px solid var(--line);position:sticky;top:0;z-index:5;color:#fff}
  header h1{font-size:18px;margin:0;color:#fff}
  .ver{font-size:12px;opacity:.85;background:#172554;border:1px solid #1d4ed8;padding:4px 8px;border-radius:8px}
</style>
</head>
<body>
<header>
  <h1>Подработки и зарплата</h1>
  <div class="ver">Версия: v6.1</div>
</header>
<main style="padding:12px;color:#ddd">
  <p>Это версия-проверка с видимой меткой. Если вы видите «Версия: v6.1» в шапке — значит подгрузился <b>новый index.html</b>.</p>
  <button id="updateAppBtn">Обновить приложение</button>
  <div id="updateStatus" style="opacity:.8;margin-top:8px"></div>
</main>

<script>
// аварийное отключение SW: ?no-sw=1
if (location.search.includes('no-sw')) {
  navigator.serviceWorker.getRegistrations().then(rs => {
    rs.forEach(r => r.unregister());
    if (window.caches) caches.keys().then(keys => keys.forEach(k => caches.delete(k)));
  });
}

if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js?v=paycalc-v3'); });
}

document.getElementById('updateAppBtn').addEventListener('click', async () => {
  const s = document.getElementById('updateStatus');
  s.textContent = 'Очищаем кэш и обновляем...';
  try {
    if('serviceWorker' in navigator) {
      const regs = await navigator.serviceWorker.getRegistrations();
      await Promise.all(regs.map(r=>r.unregister()));
    }
    if('caches' in window) {
      const keys = await caches.keys();
      await Promise.all(keys.map(k=>caches.delete(k)));
    }
  } catch(e) { console.warn(e); }
  location.replace(location.pathname + '?v=' + Date.now());
});
</script>
</body>
</html>
