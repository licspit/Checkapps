<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Подработки и зарплата — SAFE</title>
<meta name="theme-color" content="#0b0d12">
<style>
  *,*::before,*::after{box-sizing:border-box}
  :root{--bg:#0f1115;--card:#151922;--cardSoft:#1a1f2a;--text:#e9eef5;--muted:#9aa5b1;--line:#242a34;--accent:#3b82f6;--btn:#0f1320;--btnText:#e9eef5}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px;background:#0b0d12;border-bottom:1px solid var(--line);position:sticky;top:0;z-index:5;color:#fff}
  header h1{font-size:18px;margin:0;color:#fff}
  main{max-width:860px;margin:0 auto;padding:12px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin:12px 0}
  .btn{padding:14px 16px;border-radius:12px;border:1px solid var(--line);background:var(--btn);color:var(--btnText);cursor:pointer;min-height:44px}
  .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
  input{width:100%;padding:14px;border:1px solid var(--line);border-radius:12px;background:var(--btn);color:var(--btnText);min-height:44px}
  .row{display:grid;grid-template-columns:repeat(12,1fr);gap:10px}
  .col-4{grid-column:span 4}.col-12{grid-column:span 12}
  @media (max-width:860px){.col-4{grid-column:span 12}}
  .quick-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;max-width:520px;margin:0 auto}
  .quick-btn{display:flex;align-items:center;justify-content:center;min-height:56px;border-radius:12px;border:1px solid var(--line);background:var(--btn);color:var(--btnText);font-weight:600;cursor:pointer}
  .calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:10px}
  .day-head{color:var(--muted);text-align:center;font-size:12px}
  .day{position:relative;height:84px;background:var(--cardSoft);border:1px solid var(--line);border-radius:16px;cursor:pointer}
  .day .num{position:absolute;top:8px;left:0;right:0;text-align:center;font-weight:700}
  #debug{position:fixed;left:8px;right:8px;bottom:8px;background:#1f2937;color:#fff;border:1px solid #374151;border-radius:10px;padding:10px 12px;z-index:9999;display:none;white-space:pre-wrap}
  .tag{display:inline-block;background:#0b3a1f;border:1px solid #14532d;border-radius:8px;padding:6px 8px;margin-left:8px}
</style>
</head>
<body>
<header>
  <h1>Подработки и зарплата — SAFE</h1>
  <div id="jsok" class="tag">инициализация…</div>
</header>

<main>
  <section class="card">
    <div class="row">
      <div class="col-4">
        <label>Дата</label>
        <input type="date" id="shiftDate">
      </div>
      <div class="col-4">
        <label>Часы</label>
        <input type="number" id="shiftHours" min="0.25" step="0.25" placeholder="напр., 3.5">
      </div>
      <div class="col-4" style="display:flex;align-items:flex-end"><button class="btn primary" id="addShift" type="button" style="width:100%">Добавить</button></div>
    </div>
  </section>

  <section class="card">
    <div class="muted" style="margin-bottom:8px">Быстрые кнопки:</div>
    <div class="quick-grid">
      <button class="quick-btn" data-quick="hrs-3.5" type="button">3.5 ч</button>
      <button class="quick-btn" data-quick="hrs-8"   type="button">8 ч</button>
      <button class="quick-btn" data-quick="off"     type="button">Не работал</button>
      <button class="quick-btn" data-quick="vac"     type="button">Отпуск</button>
    </div>
  </section>

  <section class="card">
    <div id="log">Лог пуст</div>
  </section>
</main>

<div id="debug"></div>

<script>
(function(){
  const dbg = document.getElementById('debug');
  const logBox = document.getElementById('log');
  const jsok = document.getElementById('jsok');
  function show(msg){ dbg.style.display='block'; dbg.textContent = (dbg.textContent?dbg.textContent+'\\n':'') + msg; }
  window.onerror = function(m, s, l, c, e){ show('JS error: '+m+' @'+s+':'+l); };
  window.addEventListener('unhandledrejection', e => { show('Promise error: '+(e.reason && e.reason.message || e.reason)); });

  jsok.textContent='JS работает ✅';

  const SKEY='safe_paycalc_test';
  const state={ events:[] };

  function save(){
    try{
      localStorage.setItem(SKEY, JSON.stringify(state));
    }catch(e){
      show('localStorage недоступен: '+e);
    }
  }

  function log(msg){
    logBox.textContent = msg;
  }

  document.getElementById('shiftDate').value = new Date().toISOString().slice(0,10);

  document.getElementById('addShift').addEventListener('click', ()=>{
    const date = document.getElementById('shiftDate').value;
    const hours = parseFloat(document.getElementById('shiftHours').value||'0');
    state.events.push({date,hours,action:'add'});
    save();
    log('Добавлено: '+date+' • '+hours+' ч');
  });

  document.querySelectorAll('[data-quick]').forEach(btn=>btn.addEventListener('click', ()=>{
    const code = btn.dataset.quick;
    const date = document.getElementById('shiftDate').value;
    state.events.push({date,code,action:'quick'});
    save();
    log('Нажата кнопка: '+code+' для '+date);
  }));

})();
</script>
</body>
</html>
